
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0,
    maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <script src="https://cdn.ckeditor.com/ckeditor5/18.0.0/classic/ckeditor.js"></script>
    <link href='http://www.openhiun.com/hangul/nanumbarungothic.css' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" th:href="@{/css/base.css}" />
    <link rel="stylesheet" th:href="@{/css/board/semanticBoardForm.css}" />
    <link rel="stylesheet" th:href="@{/css/semantic.min.css}" />
    <title>글 수정 - Game Duos</title>
    <meta name="description" content="게임을 이용하는 유저들의 만남의 장이 될 수 있게
    매칭 시스템, 커뮤니티 등을 제공합니다.">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Game Duos-글 작성">
    <meta property="og:description" content="눈치 볼 필요없이 게임 같이 할 사람 구하자!">
    <meta property="og:image" content="http://">
    <meta property="og:url" content="https://GameDuos.com">
    <meta id="_csrf" name="_csrf" th:content="${_csrf.token}"/>
    <!-- default header name is X-CSRF-TOKEN -->
    <meta id="_csrf_header" name="_csrf_header" th:content="${_csrf.headerName}"/>
</head>
<body>


<!--body-->
<div th:replace="layout/header::header"></div>
<!-- middle area -->
<div class="middle-area-container">
    <section class="sec1">
        <div class="intro"></div>
    </section>
    <section class="sec2">
        <div class="left-banner-wrapper">
            <div class="left-banner"></div>
        </div>
        <div class="boardContainer">
            <div id="mainHide">
                <div class="ui raised segment">
                    <div class="form-container">
                        <form class="ui form">
                            <h2 class="ui dividing header" id="focusTop">글 작성</h2>
                            <div class="two fields">
                                <div class="field">
                                    <label>카테고리</label>
                                    <select class="ui dropdown" id="board_type">
                                        <option th:value="FREE" value="FREE">자유 게시판</option>
                                    </select>
                                </div>
                            </div>
                            <div class="one field">
                                <label>제목</label>
                                <div class="field">
                                    <input type="text" id="board_title" th:value="${board?.title}">
                                    <div class="ui negative message" id="titleNegative">
                                        <i class="close icon"></i>
                                        <div class="header">
                                            제목을 확인해주세요!
                                        </div>
                                        <ul class="list">
                                            <li>제목에 공백을 넣을 수 없어요.</li>
                                            <li>제목은 최대 30자 입니다.</li>
                                        </ul>
                                    </div>
                                </div>
                                <input type="hidden" id="board_idx" th:value="${board.idx}" />
                            </div>
                            <div class="field">
                                <label>내용</label>
                                <div class="editor-container">
                                    <div id="toolbar-container"></div>
                                    <div class="editor-wrapper">
                                        <!--id 어떻게 하기...-->
                                        <textarea name="content" id="editor" th:text="${board.content}"></textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="policy-box">
                                <div class="policy-content">
                                    <div class="ui info message"  id="policy">
                                        <div class="header">
                                            작성하기 전에 확인해주세요!
                                        </div>
                                        <ul class="list">
                                            <li>타인을 비방하거나 서로에게 불쾌감을 줄 수 있는 표현 사용 시
                                                무 통보 게시글 삭제 및 회원 정지 사유가 될 수 있으니 유의해주세요. </li>
                                            <li>불법 광고 및 금전 거래 게시글 등은 모두 제재 대상입니다. (광고 의뢰는 언제나 환영)</li>
                                            <li>새로운 겜듀인을 위해 과도한 친목질은 자제해주세요.</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="policy-checkbox">
                                    <div class="ui checkbox">
                                        <input type="checkbox" id="policyCheckbox" name="policy">
                                        <label>확인했습니다.</label>
                                    </div>
                                </div>
                            </div>
                            <div class="finish-button-container">
                                <div class="ui green button" tabindex="0" id="update">수정</div>
                                <div class="ui red button" tabindex="0" id="delete">삭제</div>
                                <div class="ui button" tabindex="0" onclick="history.back();">취소</div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="right-banner-wrapper">
            <div class="ui wide skyscraper test ad" data-text="Skyscraper"></div>
        </div>
    </section>
    </section>
</div>
<div th:replace="layout/footer::footer"></div>

<script th:src="@{/js/jquery.min.js}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.3.3/semantic.min.js"></script>
<script th:src="@{/js/basic.js}"></script>
<script th:src="@{/js/validation.js}"></script>

<script>
    $('.ui.dropdown')
        .dropdown();

    ClassicEditor
        .create( document.querySelector( '#editor' ) )
        .then( editor => {
            console.log( 'Editor was initialized', editor );
            myEditor = editor;
        } )
        .catch( error => {
            console.error( error );
        } );
</script>
<script>
    $('#update').click(function () {
        var title = $('#board_title').val();
        var inputValue = $('input[name="policy"]:checked').val();
        if (checkIsNotEmpty(title) === false) {
            $("#titleNegative").fadeIn(2000);
            document.getElementById("focusTop").scrollIntoView();
            $('#title').focus();
        } else if(checkLength(title, 50) === false){
            $("#titleNegative").fadeIn(2000);
            document.getElementById("focusTop").scrollIntoView();
            $('#title').focus();
        } else if(findUncheckedInput(inputValue) === false){
            $('#policy').attr('class','ui red message');
            document.getElementById("focusTop").scrollIntoView();
        }else{
            var jsonData = JSON.stringify({
                boardIdx: $('#board_idx').val(),
                content: myEditor.getData(),
                title: $('#board_title').val(),
                boardType: $('#board_type option:selected').val()
            });
            $.ajax({
                url: "http://localhost:8080/api/boards/" + $('#board_idx').val(),
                type: "PUT",
                data: jsonData,
                contentType: "application/json",
                dataType: "json",
                success: function () {
                    location.href = '/board/list';
                },
                error: function () {
                    alert('무엇인가 잘못되었네요!');
                }
            });
        }

    });
    $('#delete').click(function () {
        $.ajax({
            url: "http://localhost:8080/api/boards/" + $('#board_idx').val(),
            type: "DELETE",
            success: function () {
                location.href = '/board/list';
            },
            error: function () {
                alert('무엇인가 잘못되었네요!');
            }
        });
    });

</script>